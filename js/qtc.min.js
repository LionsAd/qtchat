/* $Id:*/

/**
 * @file qtc.min.js
 * The script implements the client-side functions to realize the QTChat chat function.
 */

var windowFocus=true;var un;var urn;var chatHeartbeatCount=0;var minChatHeartbeat=2000;var maxChatHeartbeat=30000;var chatHeartbeatTime=minChatHeartbeat;var heartbeatFriendlistTime=minChatHeartbeat;var originalTitle;var blinkOrder=0;var cookieName='qtc_window';var cookieNameChatbar='qtc_chatbar';var date=new Date();var chatboxFocus=new Array();var newMessages=new Array();var newMessagesWin=new Array();var chatBoxes=new Array();var chatCookies=new Array();$(document).ready(function(){originalTitle=document.title;minChatHeartbeat=Drupal.settings.qtc.minHeartbeat;maxChatHeartbeat=Drupal.settings.qtc.minHeartbeat;chatHeartbeatTime=minChatHeartbeat;heartbeatFriendlistTime=Drupal.settings.qtc.friendHeartbeat;startChatSession();loadChatBarFunc();$([window,document]).blur(function(){windowFocus=false}).focus(function(){windowFocus=true;document.title=originalTitle})});function loadChatBarFunc(){if(Drupal.settings.qtc.chatBarOptions){$('div#qtc-bar-onoffline').click(function(){$('div#qtc-barfly').toggle().toggleClass('qtc-barfly-show')});$('div#qtc-barfly-title').click(function(){$('div#qtc-barfly').toggle().toggleClass('qtc-barfly-show')});$('div#qtc-barfly-options-toggler').click(function(){$('div#qtc-barfly').toggleClass('barfly-options-visible');$('div#qtc-barfly-options').toggle().toggleClass('qtc-barfly-options-show')})}$('div.qtc-barfly-option-close').click(function(){$('div#qtc-barfly').toggleClass('barfly-options-visible');$('div#qtc-barfly-options').toggle().toggleClass('qtc-barfly-options-show')});var a='';if(Drupal.settings.qtc.friend_m!='no'){$('#qtc-barfly-sticky-friendlist-wrapper input:checkbox').click(function(){if($(this).attr('checked')==true){a='sticky'}if($(this).attr('checked')==false){a='unsticky'}$.cookie(cookieNameChatbar,a,{expires:365,path:'/'})})}if(Drupal.settings.qtc.friend_m=='no'){a='unsticky';$.cookie(cookieNameChatbar,a,{expires:365,path:'/'})}}function restructureChatBoxes(){align=0;for(x in chatBoxes){if($("div#chatbox_"+chatBoxes[x]).css('display')!='none'){if(align==0){if(Drupal.settings.qtc.chatBar){$("div#chatbox_"+chatBoxes[x]).css({'right':'185px','bottom':'0'})}else{$("div#chatbox_"+chatBoxes[x]).css({'right':'20px','bottom':'0'})}}else{if(Drupal.settings.qtc.chatBar){width=(align)*(245)+19+165}else{width=(align)*(245+7)+20}$("div#chatbox_"+chatBoxes[x]).css({'right':width+'px','bottom':'0'})}align++}}}function chatWith(a,b,c){createChatBox(false,a,b,c);$("div#chatbox_"+a+" .chatboxtextarea").focus()}function emptyHistory(a){$('div#chatbox_'+a+' .chatboxcontent .chatboxmessage').remove();$.post(Drupal.settings.qtc.baseUrl+"/qtc/history/empty")}function createChatBox(b,c,d,e,m,t,f){if($("div#chatbox_"+c).length>0){if($("div#chatbox_"+c+".collapsed")){$('div#chatbox_'+c).removeClass('collapsed');$('div#chatbox_'+c).addClass('collapsible');$("div#chatbox_"+c).css({display:'block'});$('div#chatbox_'+c+' .chatboxsubhead').css('display','block');$('div#chatbox_'+c+' .chatboxcontent').css('display','block');$('div#chatbox_'+c+' .chatboxinput').css('display','block');$("div#chatbox_"+c+'.collapsible .chatboxhead').css({background:Drupal.settings.qtc.color});reorganizeMinimizedCookie('remove',c)}$("div#chatbox_"+c+" .chatboxtextarea").focus();return}if(b==false){$.ajax({type:"POST",url:Drupal.settings.qtc.baseUrl+"/qtc/ajax/data",data:"t_id="+c,cache:false,dataType:"json",success:function(a){_createChatBox(a,c,d,e,m,t,f)}})}else{_createChatBox(b,c,d,e,m,t,f)}}function _createChatBox(a,b,c,d,m,t,e){var f=a.avatar;var g;var h='';var k='';var l='';var n='';var o='chatbox';var p=Drupal.settings.qtc.color;var q='';var r='';var s='';var u='';if(a.online==0||a.online==3){q=Drupal.t('Offline');r='offline';p='#D8D8D8'}if(a.online==1){n='none';q=Drupal.t('Online');r='online'}if(a.online==4){q=Drupal.t('Busy');r='busy'}h='<div id="qtc-bar-user-stat-online_'+b+'" style="display: '+l+';" class="user-stat-'+r+' chat-message">'+q+'</div>';if(Drupal.settings.qtc.chatBar){o='chatbar-on qtc-chatbox'}else{o='chatbar-off qtc-chatbox'}if(Drupal.settings.qtc.clickableChWname==2){s=' clickable-yes'}if(Drupal.settings.qtc.clickableChWname==1){s=' clickable-no'}$("<div />").attr({id:"chatbox_"+b,tid:b}).addClass(o).html('<div class="chatboxhead'+s+'" style="background-color: '+p+';"> <div class="chatbox-user-show"><div class="chatboxtitle clear-block">'+a.path+'</div></div> <a class="chatbox-toggler" title="'+Drupal.t('Hide/unhide')+'" href="javascript:void(0)" onclick="javascript:toggleChatBoxGrowth(\''+b+'\', \''+c+'\')"><div class="chatbox-hide"> <div class="chatbox-toggle">-</div></div></a> <div class="chatboxoptions"><a class="chatbox-close" title="'+Drupal.t('Close')+'" href="javascript:void(0)" onclick="javascript:closeChatBox(\''+b+'\', \''+c+'\')"> X </a></div></div><div style="display: none;" class="message-incoming">New message</div>'+chatboxSubhead(f,h,k,b)+'<div class="chatboxcontent-wrapper"><div class="chatboxcontent"></div><div class="chatboxinput clear-block"><div id="chatbox-inputimage"></div><div id="chatbox-inputarea"><textarea class="chatboxtextarea" onkeydown="javascript:return checkChatBoxInputKey(event,this,\''+b+'\', \''+c+'\', \''+d+'\');"></textarea></div></div></div>').appendTo($("body"));if(m&&typeof(m)!='object'){$("div#chatbox_"+b+" .chatboxcontent").append('<div class="chatboxmessage"><span class="chatboxmessagefrom">'+truncateString('name',d)+':&nbsp;&nbsp;</span><span class="chatboxmessagecontent">'+m+'</span>&nbsp;<span class="chatboxmessagetime">'+t+'</span></div>')}else if(m&&typeof(m)=='object'){for(i in m){if(m[i].i==b){m[i].fn=Drupal.t('Me')}else{if(m[i].fn.length>(Drupal.settings.qtc.truncateChBname+7)){u='display: block;'}}g=messageDate('short',m[i].t);$("div#chatbox_"+b+" .chatboxcontent").append('<div class="chatboxmessage"><span class="chatboxmessagefrom" style="'+u+'">'+truncateString('name',m[i].fn)+':&nbsp;&nbsp;</span><span class="chatboxmessagecontent">'+m[i].m+'</span>&nbsp;<span class="chatboxmessagetime">'+g+'</span></div>')}}if(a.online==1){$('div#chatbox_'+b).addClass('chatbox-user-online')}if(a.online==4){$('div#chatbox_'+b).addClass('chatbox-user-busy')}if(a.online==0||a.online==3){$('div#chatbox_'+b).addClass('chatbox-user-offline');$("div#chatbox_"+b+" .chatboxcontent").append('<div class="chatboxmessage-offline"><span class="chatboxmessagefrom">'+Drupal.t('Chat')+':&nbsp;&nbsp;</span><span class="chatboxmessagecontent">'+Drupal.t('User is offline.')+'</span>&nbsp;<span class="chatboxmessagetime">'+messageDate('short')+'</span></div>')}$('div#chatbox_'+b).addClass('collapsible');$("div#chatbox_"+b).css('bottom','0px');chatBoxeslength=0;for(x in chatBoxes){if($("div#chatbox_"+chatBoxes[x]).css('display')!='none'){chatBoxeslength++}}if(chatBoxeslength==0){if(Drupal.settings.qtc.chatBar){$("div#chatbox_"+b).css({'right':'184px','bottom':'0'})}else{$("div#chatbox_"+b).css({'right':'20px','bottom':'0'})}}else{if(Drupal.settings.qtc.chatBar){width=(chatBoxeslength)*(245)+19+165}else{width=(chatBoxeslength)*(245+7)+20}$("div#chatbox_"+b).css({'right':width+'px','bottom':'0'})}chatBoxes.push(b);chatBoxeslength+=1;if(e==1){minimizedChatBoxes=new Array();if($.cookie('chatbox_minimized')){minimizedChatBoxes=$.cookie('chatbox_minimized').split(/\|/)}minimize=0;for(j=0;j<minimizedChatBoxes.length;j++){if(minimizedChatBoxes[j]==b){minimize=1}}if(minimize==1){$('div#chatbox_'+b).addClass('collapsed');$('div#chatbox_'+b).removeClass('collapsible');$('div#chatbox_'+b+' .chatboxsubhead').css('display','none');$('div#chatbox_'+b+' .chatboxcontent').css('display','none');$('div#chatbox_'+b+' .chatboxinput').css('display','none')}else{$('div#chatbox_'+b).addClass('collapsible');$('div#chatbox_'+b).removeClass('collapsed');$("div#chatbox_"+b+' .chatboxhead').css({background:Drupal.settings.qtc.color})}}$("div#chatbox_"+b+'.collapsible .chatboxhead').css({background:Drupal.settings.qtc.color});chatBoxes.sort(numComparisonAsc);chatboxFocus[b]=false;$("div#chatbox_"+b+" .chatboxtextarea").blur(function(){chatboxFocus[b]=false}).focus(function(){chatboxFocus[b]=true;newMessages[b]=false;$("div#chatbox_"+b+" .chatboxtextarea").addClass('chatboxtextareaselected')});$("div#chatbox_"+b).click(function(){if($('div#chatbox_'+b+' .chatboxcontent').css('display')!='none'&&$('div#chatbox_'+b+'.chatbox-user-online').css('')){$("div#chatbox_"+b+" .chatboxtextarea").focus()}});$("div#chatbox_"+b).show();var v=$("div#chatbox_"+b+" .chatboxcontent");if(v[0]){$("div#chatbox_"+b+" .chatboxcontent").scrollTop($("#chatbox_"+b+" .chatboxcontent")[0].scrollHeight)}}function chatboxSubhead(a,b,c,d){var e='';e='<div class="chatboxsubhead clear-block">';e+='<span class="chat-avatar">'+a+'</span>';e+='<div class="chatbox-actions clear-block">';e+=b+''+c;e+='<a href="javascript:void(0)" onclick="javascript:emptyHistory(\''+d+'\')" class="history-empty-link" title="'+Drupal.t('Empty history')+'"><span>'+Drupal.t('Empty history')+'</span></a>';e+='<a href="'+Drupal.settings.qtc.baseUrl+'/qtc/history/show/'+d+'?popup=1" onclick="var w=window.open(this.href, \'chat_history_window\', \'width=400,height=500,scrollbars,resizable\'); w.focus(); return false;" class="history-show-link" title="'+Drupal.t('Chat history')+'"><span>'+Drupal.t('Chat history')+'</span></a>';e+='</div></div>';return e}function chatHeartbeat(){var d=0;if(windowFocus==false){var e=0;var f=0;for(x in newMessagesWin){if(newMessagesWin[x]==true){++e;if(e>=blinkOrder){document.title=x+' '+Drupal.t('says ...');f=1;break}}}if(f==0){document.title=originalTitle;blinkOrder=0}else{++blinkOrder}}else{for(x in newMessagesWin){newMessagesWin[x]=false}}for(x in newMessages){if(newMessages[x]==true){if(chatboxFocus[x]==false){$('div#chatbox_'+x+' .chatboxhead').toggleClass('chatboxblink')}}}$.ajax({type:"GET",url:Drupal.settings.qtc.baseUrl+"/qtc/ajax/heartbeat",data:"t_id="+Drupal.settings.qtc.uid,cache:false,dataType:"json",success:function(c){$.each(c.items,function(i,a){if(i>0){return}if(a){t_un=a.f;t_id=a.i;if($("div#chatbox_"+t_id).length<=0){createChatBox(false,t_id,t_un,a.fn,a.m,a.t)}if($("div#chatbox_"+t_id).css('display')=='none'){$("div#chatbox_"+t_id).css('display','block');restructureChatBoxes()}if(a.s==1){a.f=un}if(a.s==2){$("div#chatbox_"+t_id+" .chatboxcontent").append('<div class="chatboxmessage"><span class="chatboxinfo">'+a.m+'</span></div>')}else{newMessages[a.fn]=true;newMessagesWin[a.fn]=true;$("div#chatbox_"+t_id+" .chatboxcontent").append('<div class="chatboxmessage"><span class="chatboxmessagefrom">'+a.fn+':&nbsp;&nbsp;</span><span class="chatboxmessagecontent">'+a.m+'</span>&nbsp;<span class="chatboxmessagetime">'+a.t+'</span></div>');if($('div#chatbox_'+t_id+' .chatboxcontent').css('display')=='none'){$('div#chatbox_'+t_id+' .message-incoming').show();$('div#chatbox_'+t_id+' .chatbox-hide').click(function(){$('div#chatbox_'+t_id+' .message-incoming').hide()})}}var b=$("div#chatbox_"+t_id+" .chatboxcontent");if(b[0]){$("div#chatbox_"+t_id+" .chatboxcontent").scrollTop($("div#chatbox_"+t_id+" .chatboxcontent")[0].scrollHeight)}d+=1}++i});chatHeartbeatCount++;if(d>0){chatHeartbeatTime=minChatHeartbeat;chatHeartbeatCount=1}else if(chatHeartbeatCount>=Drupal.settings.qtc.heartbeat_1){chatHeartbeatTime*=3;chatHeartbeatCount=1}else if(chatHeartbeatCount>=Drupal.settings.qtc.heartbeat_2){chatHeartbeatTime*=4;chatHeartbeatCount=1;if(chatHeartbeatTime>maxChatHeartbeat){chatHeartbeatTime=maxChatHeartbeat}}setTimeout('chatHeartbeat();',chatHeartbeatTime)}})}function chatHeartbeatFriendlist(){var m=new Array();var n=$('div.qtc-chatbox');var o=new Array();$.each(n,function(x,a){var b=a.id;var c=b.substr(8);o[x]=c});var p=Drupal.t('Chat with user');if(Drupal.settings.qtc.invite_title==2){p=Drupal.t('Invite to chat')}if(Drupal.settings.qtc.invite_title==3){p=Drupal.t('Chat')}var q=false;if(!Drupal.settings.qtc.os_variant||Drupal.settings.qtc.os_variant==0||Drupal.settings.qtc.friend_m=='no'){q="data_get="+o}var r='';var s='';var t='';$.ajax({type:"POST",url:Drupal.settings.qtc.baseUrl+"/qtc/ajax/heartbeat-userdata",data:q,cache:true,dataType:"json",success:function(g){g.stamp=Number(new Date());$(window).data('userList',g);var h='';$.each(g.items,function(i,a){if(a){m[i]=i;t=a.name;if(a.realname){t=a.realname}if(a.status==0||a.status==3){h='status-offline';$('div#chatbox_'+i+' .warning-busy').remove()}if(a.status==1){h='status-online';$('div#chatbox_'+i+' .warning-busy').remove()}if(a.status==4){h='status-busy'}s+='<a href="javascript:void(0)" title="'+p+'" class="qtc-chat-invite '+h+'" style="" onclick="javascript:chatWith(\''+i+'\', \''+a.name+'\', \''+a.realname+'\')"><span class="truncate-friendname">'+truncateString('name',t)+'</span></a>';r+='<a href="javascript:void(0)" title="'+p+'" class="qtc-chat-invite '+h+'" style="" onclick="javascript:chatWith(\''+i+'\', \''+a.name+'\', \''+a.realname+'\')"><span class="truncate-friendname">'+t+'</span></a>'}});if(g.count==0){s='<span id="qtc-friends-empty">'+Drupal.t('No online friends.')+'</span>'}var j=0;if(g.count<=Drupal.settings.qtc.chatbarFriendsListHeight){$('div#qtc-barfly-friends-list-height-wrapper').removeClass();$('div#qtc-barfly-friends-list-height-wrapper').addClass('block-list-height-auto')}if(g.count>Drupal.settings.qtc.chatbarFriendsListHeight){j=Drupal.settings.qtc.chatbarFriendsListHeight;$('div#qtc-barfly-friends-list-height-wrapper').removeClass();$('div#qtc-barfly-friends-list-height-wrapper').addClass('block-list-height-'+j)}$('div#qtc-barfly-friends-list-height-wrapper').html(s);$('div.qtc-bar-user-online-counter').text(g.count);var k=0;var l=$('#qtc-friends-block-list-wrapper a.qtc-chat-invite').height();if(g.count==0){r='<span id="qtc-friends-empty">'+Drupal.t('There are no online friends.')+'</span>'}if(g.count<=Drupal.settings.qtc.friendsListHeight){$('div#qtc-friends-block-list-height-wrapper').removeClass();$('div#qtc-friends-block-list-height-wrapper').addClass('block-list-height-auto')}if(g.count>Drupal.settings.qtc.friendsListHeight){k=Drupal.settings.qtc.friendsListHeight;$('div#qtc-friends-block-list-height-wrapper').removeClass();$('div#qtc-friends-block-list-height-wrapper').addClass('block-list-height-'+k)}$('div#qtc-friends-block-list-height-wrapper').html(r);$.each(o,function(b,a){if(!m[o[b]]){if($('div#chatbox_'+o[b]+'.collapsed').length){$('div#chatbox_'+o[b]+' .chatboxhead').css({background:'#D8D8D8'})}$('span#qtc-bar-user-stat-online_'+o[b]).removeClass('user-stat-online');$('span#qtc-bar-user-stat-online_'+o[b]).removeClass('user-stat-invisible');$('span#qtc-bar-user-stat-online_'+o[b]).removeClass('user-stat-busy');$('span#qtc-bar-user-stat-online_'+o[b]).addClass('user-stat-offline');$('span#qtc-bar-user-stat-online_'+o[b]).html(Drupal.t('Offline'));$('span#qtc-bar-user-stat-offline_'+o[b]).css('display','block');$('div#chatbox_'+o[b]).removeClass('chatbox-user-online');$('div#chatbox_'+o[b]).removeClass('chatbox-user-busy');$('div#chatbox_'+o[b]).removeClass('chatbox-user-invisible');$('div#chatbox_'+o[b]).addClass('chatbox-user-offline');$('span#chatboxtitle-status_'+o[b]).removeClass('chat-status-online');$('span#chatboxtitle-status_'+o[b]).removeClass('chat-status-invisible');$('span#chatboxtitle-status_'+o[b]).removeClass('chat-status-busy');$('span#chatboxtitle-status_'+o[b]).addClass('chat-status-offline');$('#chatbox_'+o[b]+' .chatboxmessage-offline').remove();$("div#chatbox_"+o[b]+" .chatboxcontent").append('<div class="chatboxmessage-offline"><span class="chatboxmessagefrom">'+Drupal.t('Chat')+':&nbsp;&nbsp;</span><span class="chatboxmessagecontent">'+Drupal.t('User is offline.')+'</span>&nbsp;<span class="chatboxmessagetime">'+messageDate('short')+'</span></div>')}else{var c='';var d='';var e='';var f='';if(g.items[o[b]]['status']==0){c='user-stat-offline';d='chatbox-user-offline';e='chat-status-offline';f=Drupal.t('Offline')}if(g.items[o[b]]['status']==1){c='user-stat-online';d='chatbox-user-online';e='chat-status-online';f=Drupal.t('Online')}if(g.items[o[b]]['status']==3){c='user-stat-offline';d='chatbox-user-offline';e='chat-status-offline';f=Drupal.t('Offline')}if(g.items[o[b]]['status']==4){c='user-stat-busy';d='chatbox-user-busy';e='chat-status-busy';f=Drupal.t('Busy')}$('div#qtc-bar-user-stat-online_'+o[b]).css('display','block');$('div#qtc-bar-user-stat-online_'+o[b]).show();$('div#chatbox_'+o[b]).removeClass('chatbox-user-online');$('div#chatbox_'+o[b]).removeClass('chatbox-user-offline');$('div#chatbox_'+o[b]).removeClass('chatbox-user-invisible');$('div#chatbox_'+o[b]).removeClass('chatbox-user-busy');$('div#chatbox_'+o[b]).addClass(d);$('span#chatboxtitle-status_'+o[b]).removeClass('chat-status-online');$('span#chatboxtitle-status_'+o[b]).removeClass('chat-status-offline');$('span#chatboxtitle-status_'+o[b]).removeClass('chat-status-invisible');$('span#chatboxtitle-status_'+o[b]).removeClass('chat-status-busy');$('span#chatboxtitle-status_'+o[b]).addClass(e);$('div#qtc-bar-user-stat-online_'+o[b]).removeClass('user-stat-online');$('div#qtc-bar-user-stat-online_'+o[b]).removeClass('user-stat-offline');$('div#qtc-bar-user-stat-online_'+o[b]).removeClass('user-stat-invisible');$('div#qtc-bar-user-stat-online_'+o[b]).removeClass('user-stat-busy');$('div#qtc-bar-user-stat-online_'+o[b]).addClass(c);$('div#qtc-bar-user-stat-online_'+o[b]).html(f);$('#chatbox_'+o[b]+' .chatboxmessage-offline').remove()}});setTimeout('chatHeartbeatFriendlist();',heartbeatFriendlistTime)}})}function closeChatBox(b,c){$('div#chatbox_'+b).remove();$.post(Drupal.settings.qtc.baseUrl+"/qtc/ajax/close",{t_id:b,chatbox:c},function(a){});reorganizeMinimizedCookie('remove',b);for(i=0;i<chatBoxes.length;i++){if(chatBoxes[i]==b){chatBoxes.splice(i,1);chatBoxeslength-=1}}restructureChatBoxes()}function toggleChatBoxGrowth(a,b){var c;if($('div#chatbox_'+a+' .chatboxcontent').css('display')=='none'){if($.cookie('chatbox_minimized')){minimizedChatBoxes=$.cookie('chatbox_minimized').split(/\|/)}c='';for(i=0;i<minimizedChatBoxes.length;i++){if(minimizedChatBoxes[i]==a){minimizedChatBoxes.splice(i,1)}}c=minimizedChatBoxes.join('|');$.cookie('chatbox_minimized',c,{expires:365,path:'/'});$('div#chatbox_'+a).removeClass('collapsed');$('div#chatbox_'+a).addClass('collapsible');$('div#chatbox_'+a+' .chatboxhead').css({background:Drupal.settings.qtc.color});$('div#chatbox_'+a+' .chatboxsubhead').css('display','block');$('div#chatbox_'+a+' .chatboxcontent').css('display','block');$('div#chatbox_'+a+' .chatboxinput').css('display','block');$("div#chatbox_"+a+" .chatboxcontent").scrollTop($("#chatbox_"+a+" .chatboxcontent")[0].scrollHeight)}else{c=a;if($.cookie('chatbox_minimized')){c+='|'+$.cookie('chatbox_minimized')}$.cookie('chatbox_minimized',c,{expires:365,path:'/'});$('div#chatbox_'+a).addClass('collapsed');$('div#chatbox_'+a).removeClass('collapsible');$('div#chatbox_'+a+' .chatboxhead').removeAttr('style');$('div#chatbox_'+a+' .chatboxsubhead').css('display','none');$('div#chatbox_'+a+' .chatboxcontent').css('display','none');$('div#chatbox_'+a+' .chatboxinput').css('display','none')}}function chatBoxDisplay(){var a=$.cookie('chatbox_minimized').split(/\|/);for(i=0;i<a.length;i++){$('div#chatbox_'+a[i]+' .chatboxsubhead').css('display','none');$('div#chatbox_'+a[i]+' .chatboxcontent').css('display','none');$('div#chatbox_'+a[i]+' .chatboxinput').css('display','none')}}function reorganizeMinimizedCookie(a,b){var c=$.cookie('chatbox_minimized');if(c==null){return}c=$.cookie('chatbox_minimized').split(/\|/);for(i=0;i<c.length;i++){if(c[i]==b){c.splice(i,1)}}newCookie=c.join('|');$.cookie('chatbox_minimized',newCookie,{expires:365,path:'/'})}function checkChatBoxInputKey(b,c,d,e,f){var g=$.browsers.browser();var h=$.browsers.version.string();var i=18;var j=18;var k='';var l=198;var m=crossBoxContentHeight(d);var n='';if(b.keyCode==13&&b.shiftKey==0){message=$(c).val();message=message.replace(/^\s+|\s+$/g,"");urn=Drupal.t('Me');var o=messageDate('short');$(c).val('');$("div#chatbox_"+d).focus();if(message!=''){$.post(Drupal.settings.qtc.baseUrl+"/qtc/ajax/send",{t_id:d,to:e,to_name:f,message:message},function(a){message=message.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;");if($("div#chatbox_"+d+".chatbox-user-busy").length){n='<div class="warning-busy">'+Drupal.t('User busy. Please respect his status.')+'</div>'}$('div.warning-busy').remove();$("div#chatbox_"+d+" .chatboxcontent").append('<div class="chatboxmessage"><span class="chatboxmessagefrom">'+urn+':&nbsp;&nbsp;</span><span class="chatboxmessagecontent">'+message+'</span>&nbsp;<span class="chatboxmessagetime">'+o+'</span></div>'+n);$("div#chatbox_"+d+" .chatboxcontent").scrollTop($("div#chatbox_"+d+" .chatboxcontent")[0].scrollHeight)});$(c).css('height','18px');$(c).css('overflow','hidden');$("div#chatbox_"+d+" .chatboxcontent").height(198)}chatHeartbeatTime=minChatHeartbeat;chatHeartbeatCount=1;return false}if(crossScrollHeight(c)>i){i=crossScrollHeight(c);m=l-crossScrollHeight(c)+j;if(crossScrollHeight(c)>54){$(c).css('height',54+'px');$(c).css('overflow-y','auto');$("div#chatbox_"+d+" .chatboxcontent").height(162);if(g=='Internet Explorer'&&h>=8.0&&h<9){$("div#chatbox_"+d+" .chatboxcontent").height(163)}}else{$(c).css('height',i+'px');$("div#chatbox_"+d+" .chatboxcontent").height(m);if(g=='Internet Explorer'&&h>=8.0&&h<9){$("div#chatbox_"+d+" .chatboxcontent").height(m+1)}}}if(crossScrollHeight(c)<i){k=(crossScrollHeight(c)+4)-j;m=l-(crossScrollHeight(c)+4)+(j*2);$(c).css('height',k+'px');$("div#chatbox_"+d+" .chatboxcontent").height(m);if(crossScrollHeight(c)<54){$(c).css('overflow','hidden')}}if(crossScrollHeight(c)==18){$(c).css('height','18px');$(c).css('overflow','hidden');$("div#chatbox_"+d+" .chatboxcontent").height(198)}}function startChatSession(){$.ajax({type:"POST",url:Drupal.settings.qtc.baseUrl+"/qtc/ajax/data",data:"c_id=1",cache:true,dataType:"json",success:function(c){setTimeout('chatHeartbeat();',chatHeartbeatTime);$.each(c.items,function(i,a){if(a){var b=a.i;createChatBox(a,a.t_id,a.chatuser,a.name,a.items,false,1);if(a.s==1){a.f=un}if(a.s==2){$("div#chatbox_"+b+" .chatboxcontent").append('<div class="chatboxmessage"><span class="chatboxinfo">'+a.m+'</span></div>')}else{if(a.f==c.un){a.fn=Drupal.t('Me')}$("div#chatbox_"+b+" .chatboxcontent").append('<div class="chatboxmessage"><span class="chatboxmessagefrom">'+a.fn+':&nbsp;&nbsp;</span><span class="chatboxmessagecontent">'+a.m+'</span></div>')}}});if(Drupal.settings.qtc.friend_m=='no'){$('div.qtc-bar-user-online-counter').text(c.count)}setTimeout('chatHeartbeatFriendlist();',Drupal.settings.qtc.friendHeartbeat)}})}function goOffOnline(a,b){$.ajax({type:"GET",url:Drupal.settings.qtc.baseUrl+"/qtc/ajax/set-online-status",data:"os_act="+a+"&id="+b,success:function(){if(a==0){$('#qtc-barfly-online-indicator-on').hide();$('#qtc-barfly-online-indicator-off').show();$('#qtc-bar-online-indicator').removeClass('qtc-user-online');$('#qtc-bar-online-indicator').addClass('qtc-user-offline');$('#qtc-friends-block-onoffline-wrapper #qtc-friends-block-toggler-on').hide();$('#qtc-friends-block-onoffline-wrapper #qtc-friends-block-toggler-off').show();$('#qtc-toggler-block-onoffline-wrapper #qtc-toggler-block-toggler-on').hide();$('#qtc-toggler-block-onoffline-wrapper #qtc-toggler-block-toggler-off').show()}if(a==1){$('#qtc-barfly-online-indicator-on').show();$('#qtc-barfly-online-indicator-off').hide();$('#qtc-bar-online-indicator').addClass('qtc-user-online');$('#qtc-bar-online-indicator').removeClass('qtc-user-offline');$('#qtc-friends-block-onoffline-wrapper #qtc-friends-block-toggler-on').show();$('#qtc-friends-block-onoffline-wrapper #qtc-friends-block-toggler-off').hide();$('#qtc-toggler-block-onoffline-wrapper #qtc-toggler-block-toggler-on').show();$('#qtc-toggler-block-onoffline-wrapper #qtc-toggler-block-toggler-off').hide()}$('#edit-status-status selected').remove();$('#edit-status-status').val(a)}});$.sleep(3,function(){})}function setUserStatus(a,b,c){$.ajax({type:"GET",url:Drupal.settings.qtc.baseUrl+"/qtc/ajax/set-online-status",data:"act="+a+"&op="+b+"&id="+c,success:function(){$('#edit-status-status selected').remove();$('#edit-status-status').val(b);if(a==1){$('#qtc-barfly-online-indicator-on').hide();$('.qtc-status-go-offline').show();$('.qtc-status-go-invisible-on').hide();$('#qtc-barfly-invisible-indicator-on').show();$('.qtc-status-go-busy-on').hide();$('#qtc-barfly-busy-indicator-on').show();$('#qtc-bar-onoffline-wrapper .qtc-user-online').show();$('#qtc-bar-onoffline-wrapper .qtc-user-invisible').hide();$('#qtc-bar-onoffline-wrapper .qtc-user-busy').hide();$('.qtc-toggler-block-online').show();$('.qtc-toggler-block-invisible').hide();$('.qtc-toggler-block-busy').hide();$('.qtc-toggler-status-message-online').show();$('.qtc-toggler-status-message-invisible').hide();$('.qtc-toggler-status-message-busy').hide();$('#qtc-friends-block-onoffline-wrapper #qtc-friends-block-toggler-on').hide();$('#qtc-friends-block-onoffline-wrapper #qtc-friends-block-toggler-off').show()}if(a==3){$('.qtc-status-go-offline').hide();$('#qtc-barfly-online-indicator-on').show();$('#qtc-barfly-invisible-indicator-on').hide();$('.qtc-status-go-invisible-on').show();$('.qtc-status-go-busy-on').hide();$('#qtc-barfly-busy-indicator-on').show();$('#qtc-bar-onoffline-wrapper .qtc-user-online').hide();$('#qtc-bar-onoffline-wrapper .qtc-user-invisible').show();$('#qtc-bar-onoffline-wrapper .qtc-user-busy').hide();$('.qtc-toggler-block-online').hide();$('.qtc-toggler-block-invisible').show();$('.qtc-toggler-block-busy').hide();$('.qtc-toggler-status-message-online').hide();$('.qtc-toggler-status-message-invisible').show();$('.qtc-toggler-status-message-busy').hide()}if(a==4){$('.qtc-status-go-offline').hide();$('#qtc-barfly-online-indicator-on').show();$('.qtc-status-go-invisible-on').hide();$('#qtc-barfly-invisible-indicator-on').show();$('#qtc-barfly-busy-indicator-on').hide();$('.qtc-status-go-busy-on').show();$('#qtc-bar-onoffline-wrapper .qtc-user-online').hide();$('#qtc-bar-onoffline-wrapper .qtc-user-invisible').hide();$('#qtc-bar-onoffline-wrapper .qtc-user-busy').show();$('.qtc-toggler-block-online').hide();$('.qtc-toggler-block-invisible').hide();$('.qtc-toggler-block-busy').show();$('.qtc-toggler-status-message-online').hide();$('.qtc-toggler-status-message-invisible').hide();$('.qtc-toggler-status-message-busy').show()}}})}function truncateString(a,b){var c='';var d='';if(a=='name'){d=Drupal.settings.qtc.truncateChBname}if(a=='window'){d=Drupal.settings.qtc.truncateChWname}if(b.length>d){c=b.substring(0,d);c+='... '}else{c=b}return c}function crossScrollHeight(a){var h=a.scrollHeight;var b=$.browsers.browser();var c=$.browsers.version.string();if(b=='Internet Explorer'&&c>=7.0&&c<8){h+=2}if(b=='Internet Explorer'&&c==8.0&&c<9){h+=3}return h}function crossBoxContentHeight(a){var h=$("div#chatbox_"+a+" .chatboxcontent").height();var b=$.browsers.browser();var c=$.browsers.version.string();if(b=='Internet Explorer'&&c==8.0&&c<9){h-=3}return h}function messageDate(a,b){var c='';var d=new Date();if(b){d.setTime(b*1000)}var e=d.getDate();var f=d.getMonth()+1;var g=d.getFullYear();var h=d.getHours();var i=d.getMinutes();var j=d.getSeconds();var k=new Array(Drupal.t('January'),Drupal.t('February'),Drupal.t('March'),Drupal.t('April'),Drupal.t('May'),Drupal.t('June'),Drupal.t('July'),Drupal.t('August'),Drupal.t('September'),Drupal.t('October'),Drupal.t('November'),Drupal.t('December'));if(i<10){i='0'+i}if(a=='short'||!a){c=h+':'+i}if(a=='long'){c=h+':'+i+' '+k[f]+' '+e}return c}function numComparisonAsc(a,b){return a-b}(function($){$.fn.found=function(a){if(this.length){a.call(this)}}})(jQuery);(function($){$.fn.notfound=function(a){if(!this.length){a.call(this)}}})(jQuery);(function($){var c;$.sleep=function(a,b){$.sleep.sleeptimer=a;$.sleep.cback=b;$.sleep.timer=setInterval('$.sleep.count()',1000)};$.extend($.sleep,{current_i:1,sleeptimer:0,cback:null,timer:null,count:function(){if($.sleep.current_i===$.sleep.sleeptimer){clearInterval($.sleep.timer);$.sleep.cback.call(this)}$.sleep.current_i++}})})(jQuery);(function($){$.fn.getLines=function(a){return $(this).val().split("\n").length}})(jQuery);
